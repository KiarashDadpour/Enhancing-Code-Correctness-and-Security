<table border="1" cellpadding="8" cellspacing="0">
  <tr>
    <td>
      <pre><code>def _generate_signature(self, data: bytes, version: str = "v2") -> str:
    if version == "legacy":
        return hashlib.md5(data).hexdigest()
    else:
        return hmac.new(
            self.app_secret.encode(),
            data + version.encode(),
            hashlib.sha256
        ).hexdigest()</code></pre>
    </td>
  </tr>

  <tr>
    <td>
      <pre><code>def _verify_signature(self, data: bytes, signature: str, version: str) -> bool:
    if version == "legacy":
        return hashlib.md5(data).hexdigest() == signature
    else:
        expected = self._generate_signature(data, version)
        return hmac.compare_digest(expected, signature)</code></pre>
    </td>
  </tr>

  <tr>
    <td>
      <pre><code># محل آسیب‌پذیری
def _optimized_binary_deserialize(self, data: bytes) -> Any:
    try:
        return pickle.loads(data)   # ← نقطهٔ خطر
    except Exception as e:
        return self._parse_custom_binary_format(data)</code></pre>
    </td>
  </tr>
</table>
